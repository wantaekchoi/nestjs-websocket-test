<!DOCTYPE html>
<html>
  <head>
    <script src="https://cdn.socket.io/4.3.2/socket.io.min.js" integrity="sha384-KAZ4DtjNhLChOB/hxXuKqhMLYvx3b5MlT55xPEiNmREKRzeEm+RVPlTnAn0ajQNs" crossorigin="anonymous"></script>
    <style>
      #board {
        position: relative;
        height: 400px;
        width: 400px;
        border: 1px solid black;
      }
      .user {
        position: absolute;
        height: 10px;
        width: 10px;
        background-color: red;
        transform: translate(-50%, -50%);
      }
    </style>
  </head>
  <body>
    <input id="url" type="text" value="ws://localhost:3000">
    <button id="connect">Connect</button>
    <button id="disconnect">Disconnect</button>
    <div id="board"></div>

    <script>
      var socket;
      var board = document.getElementById('board');
      var urlInput = document.getElementById('url');
      var connectButton = document.getElementById('connect');
      var disconnectButton = document.getElementById('disconnect');

      var users = {};

      connectButton.onclick = function () {
        var url = urlInput.value;
        socket = io.connect(url);

        socket.on('connect', function() {
          console.log('Connected');
        });
        socket.on('state', function(user) {
          console.log('Received data: ', user);
          users[user.id] = user; // update user state

          // Clear the board
          board.innerHTML = '';
          // Draw each user on the board
          for (var id in users) {
            var user = users[id];
            var el = document.createElement('div');
            el.className = 'user';
            el.style.left = (200 + user.state.position.x * 10) + 'px';
            el.style.top = (200 - user.state.position.y * 10) + 'px';
            el.textContent = user.id;
            board.appendChild(el);
          }
        });

        window.onkeydown = function(event) {
          let direction = null;
          switch (event.key) {
            case 'ArrowUp':
              direction = 'up';
              break;
            case 'ArrowDown':
              direction = 'down';
              break;
            case 'ArrowLeft':
              direction = 'left';
              break;
            case 'ArrowRight':
              direction = 'right';
              break;
          }
          if (direction) {
            socket.emit('move', { moving: { direction, speed: 1 } });
          }
        };
      };

      disconnectButton.onclick = function() {
        if (socket) {
          socket.disconnect();
          console.log('Disconnected');
          users = {}; // reset users state
        }
      };
    </script>
  </body>
</html>
